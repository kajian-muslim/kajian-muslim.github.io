<!DOCTYPE html>
<html>
<head>
  
<title>Taklim</title>
<script src="http://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="mod_1.css">
</head>
<body>
<script src="http://kit.fontawesome.com/95a02bd20d.js"></script>
  <div class="neon">    
      <h1 id="status_server">Loading..</h1>
      <h2 id="rekaman"></h2>
      <marquee><h2 id="current"></h2></marquee>
<!--  <h1 id="status">Radio Riyadhussholihin</h1> -->
    
  </div>
  <div class="container">
    
    <div class="card" id="content">
       <div class="face face1 box-radius" >
         <div class="content" >
            <i class="fas fa-power-off" id="on"></i>
         </div>
       </div>
        <video width="200px" autoplay="autoplay" controls="controls" id="vid" muted>
            <source type="video/mp4" src="http://78.129.229.120:8143/stream"></source>
            <source type="video/ogg" src="http://78.129.229.120:8143/stream"></source>
        </video>  
    </div> 
  </div>
  <script>
    function str(data,index){
      arr = data.split('streamdata')[index];
      return arr.split('>')[1].split('<')[0]; 
    }
    function status(set){
      let status = document.querySelector("#status_server").innerHTML;
      if ((status != set)&&(status == "OFFLINE")){
        location.reload();                       
      } else {
        document.querySelector("#status_server").innerHTML = set
      }
    }
    document.addEventListener('DOMContentLoaded', function(event) {
        unMute = document.querySelector("#content")
        unMute.style.display = 'none'
        vid.style.display = 'none'
        vid = document.querySelector("#vid")
        vid.addEventListener('loadeddata', function(event) {            
            unMute.style.display = "block"            
            unMute.addEventListener('click',function(){
                if (vid.muted){
                    vid.play()                    
                    vid.muted = false                    
                    document.querySelector('.face1').setAttribute('id','power_on')
                    document.querySelector('#on').style.color = "white"
                    
                } else {
                    vid.muted = true
                    document.querySelector('.face1').removeAttribute('id','power_on')
                    document.querySelector('#on').style.color = "black"
                   
                }
            })
        }, false)

        function doRefresh(){          
          fetch(`http://getradio.000webhostapp.com/index.php?url=http://freeuk29.listen2myradio.com:8143`).then(res => res.text())
          .then( 
            data => {
              arr = data.split('streamdata').length;
              //  console.log(data)
              if (arr > 1){
                status('ONLINE');
                desc = str(data,2)
                judul = str(data,8)
                document.getElementById("current").innerHTML = judul
                document.getElementById("rekaman").innerHTML = desc
                // console.log(desc)
                // console.log(judul)
              }
              else{
                document.getElementById("status_server").innerHTML = "OFFLINE"
                document.getElementById("current").innerHTML = ""
                document.getElementById("rekaman").innerHTML = ""
                unMute.style.display = 'none'
                vid.muted = true
              }        
            })
        }
        
      setInterval(function(){doRefresh()}, 3000); 
                     

    })
      
     
     

    
      
     
  </script>
  
</body>
</html>
